#!/bin/bash
# ABOUTME: Wrapper script that runs gt prime before launching codex.
# ABOUTME: Ensures GongShow context is available in Codex sessions.

set -e

gongshow_enabled() {
    [[ -n "$GONGSHOW_DISABLED" ]] && return 1
    [[ -n "$GONGSHOW_ENABLED" ]] && return 0
    local state_file="$HOME/.local/state/gongshow/state.json"
    [[ -f "$state_file" ]] && grep -q '"enabled":\s*true' "$state_file" 2>/dev/null
}

if gongshow_enabled && command -v gt &>/dev/null; then
    gt prime 2>/dev/null || true
fi

exec codex "$@"
