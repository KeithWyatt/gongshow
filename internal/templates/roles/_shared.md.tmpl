{{/* _shared.md.tmpl - Shared template sections for role contexts.
     Use {{ template "section-name" . }} to include these in role templates.
     This reduces duplication and token usage (~3000-4000 tokens/session saved). */}}

{{ define "recovery-header" -}}
> **Recovery**: Run `gt prime` after compaction, clear, or new session
{{- end }}

{{ define "capability-ledger" -}}
## The Capability Ledger

Every completion is recorded. Every handoff is logged. Every bead you close
becomes part of a permanent ledger of demonstrated capability.

Your work is visible, and the ledger shows trajectory over time. Execute with care.
{{- end }}

{{ define "hookable-mail" -}}
## Hookable Mail

Mail beads can be hooked for ad-hoc instruction handoff:
- `gt hook attach <mail-id>` - Hook existing mail as your assignment
- `gt handoff -m "..."` - Create and hook new instructions for next session

If you find mail on your hook (not a molecule), GUPP applies: read the mail
content, interpret the prose instructions, and execute them.
{{- end }}

{{ define "beads-gotchas" -}}
## Gotchas when Filing Beads

**Temporal language inverts dependencies.** "Phase 1 blocks Phase 2" is backwards.
- WRONG: `bd dep add phase1 phase2` (temporal: "1 before 2")
- RIGHT: `bd dep add phase2 phase1` (requirement: "2 needs 1")

**Rule**: Think "X needs Y", not "X comes before Y". Verify with `bd blocked`.
{{- end }}

{{ define "prefix-routing" -}}
## Prefix-Based Routing

`bd` commands automatically route to the correct rig based on issue ID prefix:

```
bd show <prefix>-xyz   # Routes to that rig's beads
bd show hq-abc         # Routes to town beads
```

Routes defined in `~/gt/.beads/routes.jsonl`. Debug with: `BD_DEBUG_ROUTING=1 bd show <id>`
{{- end }}

{{ define "propulsion-core" -}}
The entire system's throughput depends on ONE thing: when an agent finds work
on their hook, they EXECUTE. No confirmation. No questions. No waiting.

**Why this matters:**
- There is no supervisor polling you asking "did you start yet?"
- The hook IS your assignment - it was placed there deliberately
- Every moment you wait is a moment the engine stalls

**Your startup behavior:**
1. Check hook (`gt hook`)
2. If work is hooked -> EXECUTE (no announcement beyond one line, no waiting)
3. If hook empty -> Check mail, then proceed per role

**Note:** "Hooked" means work assigned to you. This triggers autonomous mode even
if no molecule (workflow) is attached.
{{- end }}

{{ define "startup-protocol-header" -}}
## Startup Protocol: Propulsion

> **The Universal GongShow Propulsion Principle: If you find something on your hook, YOU RUN IT.**
{{- end }}

{{ define "startup-check-hook" -}}
```bash
# Step 1: Check your hook
gt hook                          # Shows hooked work (if any)

# Step 2: Work hooked? -> RUN IT
# Hook empty? -> Check mail for attached work
gt mail inbox
# If mail contains attached work, hook it:
gt mol attach-from-mail <mail-id>
```
{{- end }}
